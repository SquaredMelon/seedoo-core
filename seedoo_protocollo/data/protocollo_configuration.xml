<?xml version="1.0" encoding="utf-8"?>
<openerp>

    <data noupdate="1">
        <!-- Config Param -->
        <record id="configurazione_protocollo_default" model="protocollo.configurazione">
            <field name="rinomina_documento_allegati" eval="False"/>
            <field name="rinomina_oggetto_mail_pec" eval="False"/>
            <field name="inserisci_testo_mailpec" eval="False"/>
            <field name="genera_segnatura" eval="False"/>
            <field name="aggiungi_allegati_post_registrazione" eval="True"/>
            <field name="rinomina_documento_allegati" eval="True"/>
            <field name="segnatura_xml_parse" eval="True"/>
            <field name="segnatura_xml_invia" eval="True"/>
            <field name="conferma_xml_parse" eval="False"/>
            <field name="conferma_xml_invia" eval="False"/>
            <field name="annullamento_xml_parse" eval="False"/>
            <field name="annullamento_xml_invia" eval="False"/>
            <field name="assegnatari_competenza_uffici_required" eval="True"/>
            <field name="data_ricezione_required" eval="True"/>
            <field name="inserisci_testo_mailpec" eval="True"/>
            <field name="rinomina_oggetto_mail_pec" eval="True"/>
            <field name="lunghezza_massima_oggetto_mail" eval="256"/>
            <field name="lunghezza_massima_oggetto_pec" eval="256"/>
            <field name="email_pec_unique" eval="True"/>
            <field name="non_classificati_active" eval="True"/>
            <field name="non_fascicolati_active" eval="True"/>
            <field name="select_eml" eval="True"/>
            <field name="select_body" eval="True"/>
            <field name="select_attachments" eval="True"/>
        </record>

    </data>

    <data noupdate="1">
        <!-- Protocol Folder -->
        <record model="document.directory" id="dir_protocol">
            <field name="name">Protocollazioni</field>
            <field name="user_id" eval="False"/>
            <field name="parent_id" ref="document.dir_root"/>
            <field name="resource_id">0</field>
        </record>

        <!-- Email template for protocol notification -->
        <record id="notify_protocol" model="email.template">
            <field name="name">Assegnazione Protocollo</field>
            <field name="model_id" ref="model_protocollo_assegnazione"/>
            <field name="email_from">${object.protocollo_id.registry.company_id.email|safe}</field>
            <field name="email_to">${object.assegnatario_employee_id.user_id.partner_id.email|safe}</field>
            <field name="subject"><![CDATA[Assegnazione Protocollo ${object.protocollo_id.name} del ${format_tz(object.protocollo_id.registration_date, tz=user.tz, format='%d/%m/%Y %H:%M:%S')}]]></field>
            <field name="body_html">
                <![CDATA[
                    <p>
                        Notifica Assegnazione Protocollo ${object.protocollo_id.name} del ${format_tz(object.protocollo_id.registration_date, tz=user.tz, format='%d/%m/%Y %H:%M:%S')}.
                    </p>
                    <p>
                        Il protocollo Ã¨ stato assegnato ${object.parent_id and 'al tuo ufficio di appartenenza ' or ''}per ${object.tipologia_assegnazione}.
                    </p>
                    <p>
                        Oggetto:  ${object.protocollo_id.subject}
                    </p>
                    <p>
                        ${object.protocollo_id.type in ['in', 'internal'] and 'Mittenti' or 'Destinatari'}:  ${object.protocollo_id.sender_receivers_summary}
                    </p>
                    <p>
                        Protocollo Riservato: ${object.reserved and 'SI' or 'NO'}
                    </p>
                ]]>
            </field>
        </record>

        <record id="notify_reserved_protocol" model="email.template">
            <field name="name">Assegnazione Protocollo Riservato</field>
            <field name="model_id" ref="model_protocollo_protocollo"/>
            <field name="email_from">${object.registry.company_id.email|safe}</field>
            <field name="email_to">${object.aoo_id.reserved_employee_id.user_id.email|safe}</field>
            <field name="subject"><![CDATA[Assegnazione Protocollo ${object.name} del ${object.registration_date}]]></field>
            <field name="body_html">
                <![CDATA[
                    <p>
                        Notifica Protocollo Riservato ${object.name} del ${object.registration_date}
                    </p>
                    <p>
                        Oggetto:  ${object.subject}
                    </p>
                    <p>
                        ${object.type == 'in' and 'Mittenti' or 'Destinatari'}:  ${object.sender_receivers_summary}
                    <pre>
                        --
                        ${object.registry.company_id.name|safe}
                    </pre>
                ]]>
            </field>
        </record>
    </data>

    <!-- Cron for Journal Protocollo -->
    <data noupdate="1">
        <record id="ir_cron_journal_protocol_action" model="ir.cron">
            <field name="name">Protocol Journal Service</field>
            <field name="interval_number">1</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field name="nextcall" eval="time.strftime('%Y')+'-01-01 00:05:00.000000'"/>
            <field name="doall" eval="False"/>
            <field name="model">protocollo.journal</field>
            <field name="function">_create_journal</field>
            <field name="args">()</field>
            <field name="active" eval="True"/>
        </record>
    </data>

</openerp>
